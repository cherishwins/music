# White Tiger Status - December 30, 2025

## WHAT'S NEW TODAY

### 1. Zero-Friction First Generation
**Users can generate their first track WITHOUT signing up or paying.**

How it works:
```
First visit ‚Üí Generate FREE ‚Üí Get watermarked MP3 ‚Üí Love it? ‚Üí Pay for clean version
```

- First generation is always free (tracked via `has_used_free_generation`)
- Free tier: 3 watermarked tracks/month
- Paid: Unlimited clean downloads

**Code**: `src/app/api/generate/music/route.ts` lines 33-66

---

### 2. Funnel Tracking System
**Every user action is now tracked for conversion optimization.**

Events tracked:
| Event | When |
|-------|------|
| `page_view` | User opens app |
| `generate_start` | Clicks generate |
| `generate_complete` | Track finished |
| `preview_play` | Plays the track |
| `download_watermarked` | Downloads free version |
| `download_attempt_clean` | Tries to download clean (paywall) |
| `payment_started` | Opens payment modal |
| `payment_completed` | Payment successful |
| `signup` | Creates account |
| `share` | Shares a track |

**API Endpoint**: `POST /api/funnel/track`
```json
{
  "event": "generate_complete",
  "sessionId": "uuid",
  "userId": "optional",
  "discoverySource": "telegram_search",
  "trackId": "uuid"
}
```

**Client Library**: `src/lib/funnel.ts`
```typescript
import { trackEvent, getSessionId, createTracker } from '@/lib/funnel';

// Simple tracking
await trackEvent({
  event: 'generate_complete',
  sessionId: getSessionId(),
  trackId: newTrack.id,
});

// Auto-detected tracking
const tracker = createTracker({ userId: user?.id });
tracker.track('preview_play', { trackId });
```

---

### 3. Discovery Attribution
**Know where every user came from.**

Sources tracked:
- `telegram_search` - Found via Telegram search
- `telegram_channel` - From a Telegram channel
- `findmini` - FindMini.app directory
- `tapps_center` - tApps Center directory
- `mcp_directory` - Any MCP marketplace
- `product_hunt` - Product Hunt launch
- `tiktok` - TikTok referral
- `twitter` - Twitter/X referral
- `referral` - User referral link
- `direct` - Direct traffic

UTM params also tracked: `utm_source`, `utm_medium`, `utm_campaign`

---

### 4. A/B Testing Framework
**Test different approaches to optimize conversion.**

Pre-configured experiments:
| Experiment | What it tests |
|------------|---------------|
| `first_gen_free_v1` | Zero-friction vs signup-first |
| `watermark_severity_v1` | Audio watermark vs metadata-only |
| `per_track_vs_sub_v1` | Per-track purchase vs subscription |

**Database table**: `experiments`
```sql
SELECT * FROM experiments WHERE status = 'running';
```

---

### 5. Referral System
**Users can invite others and earn credits.**

Schema ready:
- `referrals.referral_code` - Unique code per user (e.g., `TIGER_ABC123`)
- `referrals.click_count` - How many clicked
- `referrals.signup_count` - How many signed up
- `referrals.conversion_count` - How many paid
- `referrals.credits_earned` - Rewards earned

**Usage**: `https://t.me/MSUCOBot?start=ref_TIGER_ABC123`

---

### 6. Audio Watermarking
**Free downloads get branded.**

Current implementation:
- Metadata watermark: "Made with White Tiger - whitetiger.app"
- File tagged with `encoded_by: White Tiger`

Future (when ffmpeg available):
- Audio watermark at start/end
- Subtle 40Hz tone throughout (detectable but inaudible)

**Code**: `src/lib/watermark.ts`

---

### 7. Directory Submission Playbook
**16 directories mapped with submission guides.**

See: `docs/DIRECTORY_SUBMISSIONS.md`

Week 1 priorities:
- [ ] FindMini.app
- [ ] tApps Center
- [ ] MCP.so
- [ ] MCP Market
- [ ] GitHub modelcontextprotocol/servers

---

## DATABASE SCHEMA (New Tables)

### funnel_events
```sql
CREATE TABLE funnel_events (
  id TEXT PRIMARY KEY,
  user_id TEXT,           -- nullable (anonymous users)
  anonymous_id TEXT,      -- fingerprint for pre-signup
  session_id TEXT,        -- ties events together
  event TEXT,             -- page_view, generate_complete, etc.
  discovery_source TEXT,  -- where they came from
  referral_code TEXT,     -- if referred
  utm_source TEXT,
  utm_medium TEXT,
  utm_campaign TEXT,
  track_id TEXT,          -- which track
  experiment_id TEXT,     -- A/B test
  variant TEXT,           -- which variant
  platform TEXT,          -- telegram_miniapp, web, mcp, api
  created_at INTEGER
);
```

### experiments
```sql
CREATE TABLE experiments (
  id TEXT PRIMARY KEY,
  name TEXT,
  description TEXT,
  variants TEXT,          -- JSON array
  target_percentage INTEGER,
  status TEXT,            -- draft, running, paused, completed
  primary_metric TEXT,
  started_at INTEGER,
  ended_at INTEGER
);
```

### referrals
```sql
CREATE TABLE referrals (
  id TEXT PRIMARY KEY,
  referrer_id TEXT,
  referral_code TEXT UNIQUE,
  click_count INTEGER,
  signup_count INTEGER,
  conversion_count INTEGER,
  credits_earned INTEGER
);
```

### users (new columns)
```sql
ALTER TABLE users ADD COLUMN has_used_free_generation INTEGER DEFAULT 0;
ALTER TABLE users ADD COLUMN discovery_source TEXT;
ALTER TABLE users ADD COLUMN referred_by TEXT;
```

---

## FILES CREATED TODAY

| File | Purpose |
|------|---------|
| `src/lib/funnel.ts` | Client-side funnel tracking |
| `src/lib/watermark.ts` | Audio watermark utilities |
| `src/app/api/funnel/track/route.ts` | Funnel tracking API |
| `scripts/migrations/002_funnel_tracking.sql` | Migration SQL |
| `docs/DIRECTORY_SUBMISSIONS.md` | Submission checklist |
| `docs/CUSTOMER_PLAYBOOK.md` | Customer acquisition strategy |
| `docs/GTM_STRATEGY.md` | Go-to-market strategy |

---

## FILES MODIFIED TODAY

| File | Changes |
|------|---------|
| `src/lib/db/schema.ts` | Added 3 tables + user columns |
| `src/lib/db/index.ts` | Added `trackFunnelEvent`, `canGenerateFree`, `markFreeGenerationUsed` |
| `src/app/api/generate/music/route.ts` | Zero-friction logic + funnel tracking |

---

## API CHANGES

### POST /api/generate/music

New response fields:
```json
{
  "success": true,
  "audio": "base64...",
  "isWatermarked": true,
  "freeGenerationsRemaining": 2
}
```

New headers accepted:
- `x-session-id` - For funnel tracking
- `x-user-id` - If logged in
- `x-anonymous-id` - For pre-signup tracking

---

## WHAT'S NEXT

### Immediate (This Week)
1. **Submit to directories** - Follow `docs/DIRECTORY_SUBMISSIONS.md`
2. **Create MCP package** - `@jpanda/white-tiger-mcp` for npm
3. **Generate watermark audio** - "Made with White Tiger" voiceover

### Soon (Next Week)
1. **Implement referral UI** - Share buttons, referral dashboard
2. **A/B test dashboard** - View experiment results
3. **Funnel analytics page** - Conversion visualization

### Later (Month 1)
1. **Product Hunt launch** - Full launch prep
2. **TikTok content** - Viral demos
3. **Influencer outreach** - Crypto/music creators

---

## QUICK REFERENCE

### Check Database
```bash
node -e "require('dotenv').config(); const { createClient } = require('@libsql/client'); createClient({ url: process.env.TURSO_DATABASE_URL, authToken: process.env.TURSO_AUTH_TOKEN }).execute('SELECT COUNT(*) as count FROM funnel_events').then(r => console.log('Funnel events:', r.rows[0].count));"
```

### Push Schema Changes
```bash
pnpm exec drizzle-kit push
```

### Build & Deploy
```bash
pnpm build && git add . && git commit -m "feat: funnel tracking" && git push
```

---

## DOCUMENTATION MAP

| Doc | What it covers |
|-----|----------------|
| `docs/STATUS_2025-12-30.md` | This file - today's work |
| `docs/GTM_STRATEGY.md` | Distribution, pricing, timeline |
| `docs/CUSTOMER_PLAYBOOK.md` | ICPs, journeys, conversion |
| `docs/DIRECTORY_SUBMISSIONS.md` | Where to list the app |
| `docs/INDEX.md` | Links to all docs |
| `skills/INDEX.md` | Technical skills reference |

---

*"Zero friction. Full tracking. Maximum conversion."* üêØ
